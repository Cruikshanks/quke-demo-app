dist: trusty

addons:
  sonarcloud:
    organization: "defra"

language: ruby
rvm: 2.4.2
cache: bundler

# Travis CI uses shallow clone to speed up build times, but a truncated SCM
# history may cause issues when SonarCloud computes blame data. To avoid this,
# you can access the full SCM history with `depth: false`
git:
  depth: false

before_install:
  - export TZ=UTC
  - gem install -v 1.17.3 bundler --no-document

script:
  - bundle exec rubocop --format=json --out=rubocop-result.json
  - bundle exec rspec
  - sonar-scanner

deploy:
  provider: rubygems
  api_key:
    secure: YLkxGwaFr5rx0UEkQNsCfn+h+R3IM3zIR6/PBFRYHpxgjfDD3z1ThPTQgS3MuFsim4OhlOhCSHGh7Qs1EQNqV1yFot/WNmowSHNPpA2+n9BzzEoTOjJt719KKeIzQXUqB8nxEMzE0ICJf9dZaiM+jo88adSa6JWNIBKt8CGvGQ63o6PzJniXF2RIjYD4BwVckZoUtzGUowfhQlA92X7/zkqcxwzgoKZpJ/p1kz5FZUaiMiZ8cuNIAbwmOmu1dmvVivuVhHjldi5U1Gf09qim1wyJM4+O9kWgcC3oRzyWLJU/T4C3O1bynwdK6qNHuZnLEtJwUipgcrlStB02/YtTBrO1dm6XoJm4acVY6x3FUD5P2DCFnY/khgKyyFIgjOMzjcVNPoVRASGY3j52mqpFtH1l03uMKS4EX1zgRAJt3Zh+EFN+64MICtZWRstbqntAxyk7NcoLiW5OffOYz9aLcnhAatLI2yIzYy47NttHy+YjjmTdKuzTATON0B39yQKstlIoPhk75ZmPCf1FoHXnAGjr/MiHDj9KL+Hiz3umP3jY4+Jd36+61rkrIlAFVWRWn+I98RXCruEZVr78pE/3myK12vh88H14wMQuI/h/ZJF2EwghPhFjCQl/vK8dgJZZPWSLTX+yWlyIMKMohtucggRRKzNhBm4mQ4kPAZrds0c=
  gem: quke_demo_app
  on:
    tags: true
    repo: DEFRA/quke-demo-app
